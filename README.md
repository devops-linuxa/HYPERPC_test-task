## Задача: развёртывание Nginx с использованием Ansible‑роли

**Цель**  
Создать Ansible‑роль для автоматизированного развёртывания веб‑сервера Nginx с обеспечением:
- корректной конфигурации проксирования;
- безопасности изменений через проверку конфигурации;
- возможности восстановления предыдущей версии;
- гарантированной идемпотентности выполнения.

**Требования к реализации**

1. **Шаблон конфигурации Nginx**  
   - Использовать механизм шаблонов Ansible (`template`).
   - В конфигурации обязательно задать директиву `proxy_pass`, направляющую запросы на `http://localhost:3000`.
   - Обеспечить настройку базовых заголовков проксирования:
     - `Host`;
     - `X‑Real‑IP`;
     - `X‑Forwarded‑For`;
     - `X‑Forwarded‑Proto`.

2. **Хэндлер для проверки конфигурации**  
   - Реализовать обработчик (handler), выполняющий команду `nginx -t`.
   - Проверка должна запускаться **до** применения изменений.
   - Перезапуск сервиса разрешён только при успешном прохождении проверки.

3. **Механизм резервного копирования**  
   - Перед заменой конфигурационного файла создать его резервную копию.
   - Хранить бэкапы в отдельной директории (путь настраивается переменной).
   - Именовать копии с использованием временной метки (формат ISO 8601).
   - Копировать файл только при его наличии в целевой системе.

4. **Идемпотентность**  
   - Роль должна безопасно выполняться многократно без побочных эффектов.
   - Изменения применяются только при:
     - отсутствии Nginx (установка пакета);
     - изменении шаблона конфигурации;
     - необходимости обновления параметров сервиса.
   - Статус задач должен корректно отражать фактические изменения (changed/ok).

## Проверка: развёртывания Nginx с использованием Ansible‑роли

**Забираем репозиторий к себе**
```bash
git clone https://github.com/devops-linuxa/HYPERPC_test-task.git
```

**Проваливаемся в директорию**
```bash
cd HYPERPC_test-task/
```

**Стартуем...**
```bash
ansible-playbook -i inventory.ini playbook.yml
```

**Проверяем по адресу через `curl`, либо в любимом браузере:**
```bash
 curl https://hyperpc.linuxa.ru && echo
```

**Ответ:**
```html
Тебя приветствует HYPERPC! Твой IP: XXX.XXX.XXX.XXX
```
